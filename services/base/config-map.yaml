apiVersion: azconfig.io/v1beta1
kind: AzureAppConfigurationProvider
metadata:
  name: adp-platform-vars
  namespace: flux-config
spec:
  endpoint: https://${APPCONFIG_NAME}.azconfig.io
  target:
    configMapName: adp-platform-vars
  auth:
    workloadIdentity:
      managedIdentityClientId: ${APPCONFIG_MI_CLIENTID}
  keyValues:
    selectors:
      - keyFilter: '*'
        labelFilter: adp-platform
    keyVaults:
      target:
        secretName: adp-platform-secrets
      auth:
        workloadIdentity:
          managedIdentityClientId: ${APPCONFIG_MI_CLIENTID}
      refresh:
        interval: 1m
    refresh:
      interval: 1m
      monitoring:
        keyValues:
          - key: Sentinel
            label: adp-platform